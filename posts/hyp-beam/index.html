<!doctype html><html lang=en><head><title>Hypercore Beam - Break Through NAT With This One Weird Trick :: Matthew Croughan's Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="hyp beam can be thought of as a drop-in replacement for nc, for those situations where you just can&amp;rsquo;t be bothered to set up a VPN or manually establish a path between two machines via traditional methods like port forwarding. It provides the user with a method of breaking through NAT and transferring data via the Hypercore protocol between two machines anywhere in the world. Peer discovery happens via DHT/mDNS using a concept called Hyperswarm, not too dissimilar from what Bittorrent clients have always done; although its usage of mDNS is quite unique and cool."><meta name=keywords content="linux,nixos,zfs,hypercore"><meta name=robots content="noodp"><link rel=canonical href=https://blog.croughan.sh/posts/hyp-beam/><link rel=stylesheet href=https://blog.croughan.sh/assets/style.css><link rel=stylesheet href=https://blog.croughan.sh/assets/blue.css><link rel=apple-touch-icon href=https://blog.croughan.sh/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://blog.croughan.sh/img/favicon/blue.png><meta name=twitter:card content="summary"><meta name=twitter:site content="croughan.sh"><meta name=twitter:creator content="matthewcroughan"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Hypercore Beam - Break Through NAT With This One Weird Trick"><meta property="og:description" content="hyp beam can be thought of as a drop-in replacement for nc, for those situations where you just can&amp;rsquo;t be bothered to set up a VPN or manually establish a path between two machines via traditional methods like port forwarding. It provides the user with a method of breaking through NAT and transferring data via the Hypercore protocol between two machines anywhere in the world. Peer discovery happens via DHT/mDNS using a concept called Hyperswarm, not too dissimilar from what Bittorrent clients have always done; although its usage of mDNS is quite unique and cool."><meta property="og:url" content="https://blog.croughan.sh/posts/hyp-beam/"><meta property="og:site_name" content="Matthew Croughan's Blog"><meta property="og:image" content="https://blog.croughan.sh/hyperzfs-clickbait.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2021-08-24 01:51:58 +0100 +0100"></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>croughan.sh</div></a></div></div></header><div class=content><div class=post><h1 class=post-title><a href=https://blog.croughan.sh/posts/hyp-beam/>Hypercore Beam - Break Through NAT With This One Weird Trick</a></h1><div class=post-meta><span class=post-date>2021-08-24</span>
<span class=post-author>:: Matthew Croughan</span></div><span class=post-tags>#<a href=https://blog.croughan.sh/tags/linux/>linux</a>&nbsp;
#<a href=https://blog.croughan.sh/tags/nixos/>nixos</a>&nbsp;
#<a href=https://blog.croughan.sh/tags/zfs/>zfs</a>&nbsp;
#<a href=https://blog.croughan.sh/tags/hypercore/>hypercore</a>&nbsp;</span>
<img src=https://blog.croughan.sh/hyperzfs-clickbait.png class=post-cover alt="Hypercore Beam - Break Through NAT With This One Weird Trick"><div class=post-content><div><p><code>hyp beam</code> can be thought of as a drop-in replacement for <code>nc</code>, for those
situations where you just can&rsquo;t be bothered to set up a VPN or manually
establish a path between two machines via traditional methods like port
forwarding. It provides the user with a method of breaking through NAT and
transferring data via the Hypercore protocol between two machines anywhere in
the world. Peer discovery happens via DHT/mDNS using a concept called
<a href=https://hypercore-protocol.org/guides/modules/hyperswarm/>Hyperswarm</a>, not too
dissimilar from what Bittorrent clients have always done; although its usage of
mDNS is quite unique and cool.</p><p>Hypercore Beams are end to end encrypted. There&rsquo;s no overhead that I can
measure, and it can be used directly in place of netcat. IP Address, network
conditions, network port, all cease to matter since with <code>hyp</code> since we only care
about piping data between processes. So what are some of the things I use it
for?</p><h1 id=sending-zfs-datasets-around-the-internet>Sending ZFS datasets around the internet<a href=#sending-zfs-datasets-around-the-internet class=hanchor arialabel=Anchor>&#8983;</a></h1><p><img src=/hyperzfs.png alt=image></p><p>Usually, <code>zfs send</code> requires LAN connectivity, or a VPN, which is a pain to
think about. Why think about where your machines are? With <code>hyp beam</code> I can just
push and pull ZFS datasets through an encrypted tunnel without caring where I am
in the world.</p><pre><code>## Machine 1
zfs send eggshells/data | hyp beam &quot;secret words&quot;
## Machine 2
hyp beam &quot;secret words&quot; | zfs recv zpool/data
</code></pre><p>Machine 1 pipes <code>zfs send</code> into <code>hyp beam</code> which chooses a secret. This secret
can be any string in <code>hyp beam "&lt;secret>"</code>. Machine 2 then pipes the output of
<code>hyp beam "&lt;secret>"</code> into <code>zfs recv</code>. How simple is that?</p><p>Sidenote: I call one of my pools <code>eggshells</code> because often whenever I interact
with it, it&rsquo;s like <a href=https://dictionary.cambridge.org/dictionary/english/walk-be-on-eggshells>walking on
eggshells.</a></p><h1 id=video-streams-over-the-wan>Video streams over the WAN<a href=#video-streams-over-the-wan class=hanchor arialabel=Anchor>&#8983;</a></h1><p><img src=/hypermpv.png alt=image></p><p>Sending Video over <code>hyp beam</code> is surprisingly practical. It&rsquo;s proof that <code>hyp beam</code> can be used in place of <code>nc</code>. Once you realise that this is just a peer to
peer link to send data through with no overhead, it ceases to be impressive. The
ease of use is what is amazing.</p><p>The following will use fancy bash wankery to create two FIFO pipes with which to
transmit video data from <code>ffmpeg</code> through. Such that two clients can watch the
video anywhere in the world via Hypercore, or Netcat.</p><h2 id=with-netcat>With Netcat<a href=#with-netcat class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This requires you to know the IP address of the machine, and have a direct
connection via LAN/VPN.</p><pre><code>## Sending
ffmpeg -vcodec mjpeg -i /dev/video0 -f avi - | tee -- &gt;(nc -l 1234) &gt;(nc -l 5678) &gt; /dev/null; wait

## Recieving
# Client 1
nc 127.0.0.1 1234 | mpv -
# Client 2
nc 127.0.0.1 5678 | mpv -
</code></pre><h2 id=with-hypercore-beam>With Hypercore Beam<a href=#with-hypercore-beam class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This does not require knowing the IP address of a machine, or having a direct
connection via LAN/VPN. It will work between two machines anywhere in the world
and is likely to succeed even when it encounters firewalls. The port also does
not matter, because we only care about the data being piped into a process.</p><pre><code>## Sending
ffmpeg -vcodec mjpeg -i /dev/video0 -f avi - | tee -- &gt;(hyp beam &quot;1234&quot;) &gt;(hyp beam &quot;5678&quot;) &gt; /dev/null; wait

## Recieving
# Client 1
hyp beam &quot;1234&quot; | mpv -
# Client 2
hyp beam &quot;5678&quot; | mpv -
</code></pre><h1 id=sharing-files-with-linux-savvy-friends>Sharing files with Linux savvy friends<a href=#sharing-files-with-linux-savvy-friends class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Sometimes I want to share folders or files with friends. Usually I would use
<code>magic-wormhole</code> for this, but one of the annoying things about that program is
that if you want to send a folder it first has to be zipped. That <code>zip</code> process
can take a very long time and requires you to have as much RAM as the filesize
you are trying to send. It also doesn&rsquo;t even give you as good of a compression
ratio as gzip. Since <code>hyp beam</code> only cares about piping data, we can make up our
own method of sending the folder, by using <code>tar</code>.</p><pre><code># Sender (Sending the Folder)
tar cf - &lt;folder-name&gt; | hyp beam &quot;test&quot;

# Receiver (Receiving the Folder)
hyp beam &quot;secret&quot; | tar xvf -
</code></pre><p>You could easily invent shell aliases such as <code>send-to-matt</code> or <code>receive-matt</code>
ready to pack/unpack files, hiding the <code>tar</code> command from sight such that this
feels like a proper application for sending and recieving files rather than
having to remember the <code>tar</code> syntax each time.</p><h1 id=what-will-you-use-it-for>What will you use it for?<a href=#what-will-you-use-it-for class=hanchor arialabel=Anchor>&#8983;</a></h1></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://blog.croughan.sh/posts/nixos-on-s5520ur/><span class=button__text>NixOS + the Worst UEFI ever (S5520UR)</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2021 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://blog.croughan.sh/assets/main.js></script><script src=https://blog.croughan.sh/assets/prism.js></script></div></body></html>